<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #0a0c10;
            color: #e0e6ed;
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        
        .navbar {
            background: #000;
            padding: 15px;
            border-bottom: 2px solid #b8860b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            color: #ffd700;
            font-size: 1.8rem;
            text-decoration: none;
        }
        
        .user-info {
            color: #ffd700;
        }
        
        .logout {
            color: #ffd700;
            text-decoration: none;
            padding: 5px 15px;
            border: 1px solid #b8860b;
        }
        
        .game-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }
        
        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            background: #1a1e26;
            padding: 20px;
            border: 2px solid #b8860b;
            margin-bottom: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-label {
            color: #b8860b;
            font-size: 0.9rem;
        }
        
        .stat-value {
            color: #ffd700;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        /* –ö–∞—Ä—Ç–∞ */
        .map-container {
            background: #1a1e26;
            padding: 20px;
            border: 2px solid #b8860b;
            margin-bottom: 20px;
        }
        
        .map-title {
            color: #ffd700;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }
        
        .map-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
        }
        
        .map-cell {
            aspect-ratio: 1;
            background: #2a2f3a;
            border: 1px solid #b8860b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .map-cell:hover {
            background: #3d4350;
            transform: scale(1.05);
        }
        
        .map-cell.player {
            background: #ffd700;
            color: #000;
            box-shadow: 0 0 20px gold;
        }
        
        .map-cell.visited {
            opacity: 0.8;
        }
        
        /* –î–µ–π—Å—Ç–≤–∏—è */
        .actions-panel {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .action-btn {
            background: #1a1e26;
            border: 2px solid #b8860b;
            color: #ffd700;
            padding: 15px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .action-btn:hover {
            background: #b8860b;
            color: #000;
        }
        
        /* –õ–æ–≥ */
        .log-panel {
            background: #1a1e26;
            padding: 20px;
            border: 2px solid #b8860b;
            height: 200px;
            overflow-y: auto;
        }
        
        .log-title {
            color: #ffd700;
            font-size: 1.3rem;
            margin-bottom: 10px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #ffd700;
        }
        
        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory-panel {
            background: #1a1e26;
            padding: 20px;
            border: 2px solid #b8860b;
            margin-top: 20px;
        }
        
        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 10px;
        }
        
        .inventory-item {
            background: #2a2f3a;
            padding: 10px;
            text-align: center;
            border: 1px solid #b8860b;
        }
        
        @media (max-width: 768px) {
            .stats-panel { grid-template-columns: repeat(3, 1fr); }
            .actions-panel { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <a href="/" class="logo">‚öîÔ∏è NORDSAGA</a>
        <span class="user-info">üë§ <%= user.username %></span>
        <a href="/logout" class="logout">–í—ã–π—Ç–∏</a>
    </nav>
    
    <div class="game-container">
        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="stats-panel" id="stats">
            <div class="stat">
                <div class="stat-label">üëë –°–ª–∞–≤–∞</div>
                <div class="stat-value" id="glory">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">üí∞ –ó–æ–ª–æ—Ç–æ</div>
                <div class="stat-value" id="gold">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">üõ°Ô∏è –î—Ä—É–∂–∏–Ω–∞</div>
                <div class="stat-value" id="crew">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">‚öîÔ∏è –°–∏–ª–∞</div>
                <div class="stat-value" id="power">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">üçñ –ï–¥–∞</div>
                <div class="stat-value" id="food">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">üìÖ –î–µ–Ω—å</div>
                <div class="stat-value" id="day">1</div>
            </div>
        </div>
        
        <!-- –ö–∞—Ä—Ç–∞ -->
        <div class="map-container">
            <div class="map-title">üó∫Ô∏è –ö–ê–†–¢–ê –ú–ò–î–ì–ê–†–î–ê</div>
            <div class="map-grid" id="map"></div>
        </div>
        
        <!-- –î–µ–π—Å—Ç–≤–∏—è -->
        <div class="actions-panel">
            <button class="action-btn" onclick="move('north')">‚¨ÜÔ∏è –°–ï–í–ï–†</button>
            <button class="action-btn" onclick="move('south')">‚¨áÔ∏è –Æ–ì</button>
            <button class="action-btn" onclick="move('west')">‚¨ÖÔ∏è –ó–ê–ü–ê–î</button>
            <button class="action-btn" onclick="move('east')">‚û°Ô∏è –í–û–°–¢–û–ö</button>
            <button class="action-btn" onclick="rest()">üèïÔ∏è –û–¢–î–´–•</button>
            <button class="action-btn" onclick="hunt()">üèπ –û–•–û–¢–ê</button>
            <button class="action-btn" onclick="trade()">üí∞ –¢–û–†–ì–û–í–õ–Ø</button>
            <button class="action-btn" onclick="saveGame()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
        </div>
        
        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="log-panel">
            <div class="log-title">üìú –°–ê–ì–ê –û –¢–ï–ë–ï</div>
            <div id="log"></div>
        </div>
        
        <!-- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å -->
        <div class="inventory-panel">
            <div class="log-title">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</div>
            <div class="inventory-grid" id="inventory"></div>
        </div>
    </div>
    
    <script>
        // –ò–≥—Ä–æ–∫
        let player = {
            x: 2, y: 2,
            glory: 100,
            gold: 200,
            crew: 50,
            power: 100,
            food: 30,
            day: 1,
            inventory: {
                wood: 10,
                iron: 5,
                weapons: 3,
                treasure: 0
            }
        };
        
        // –ö–∞—Ä—Ç–∞
        let map = [
            ['üè∞', 'üå≤', '‚õ∞Ô∏è', 'üåä', 'üè°'],
            ['üå≤', 'üè°', 'üå≤', '‚õ∞Ô∏è', 'üåä'],
            ['üåä', 'üå≤', 'üè°', 'üå≤', '‚õ∞Ô∏è'],
            ['‚õ∞Ô∏è', 'üåä', 'üå≤', 'üè∞', 'üå≤'],
            ['üè°', '‚õ∞Ô∏è', 'üåä', 'üå≤', 'üè∞']
        ];
        
        // –ü–æ—Å–µ—â–µ–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏
        let visited = {'2,2': true};
        let log = [];
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        async function loadGame() {
            try {
                const response = await fetch('/api/load');
                const data = await response.json();
                if (data.game) {
                    player = data.game;
                    renderMap();
                    updateStats();
                    addLog('–ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–≥—Ä—ã
        async function saveGame() {
            try {
                await fetch('/api/save', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ gameData: player })
                });
                addLog('–ò–≥—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞');
            } catch (e) {
                addLog('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            document.getElementById('glory').innerHTML = player.glory;
            document.getElementById('gold').innerHTML = player.gold;
            document.getElementById('crew').innerHTML = player.crew;
            document.getElementById('power').innerHTML = player.power;
            document.getElementById('food').innerHTML = player.food;
            document.getElementById('day').innerHTML = player.day;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç—ã
        function renderMap() {
            let html = '';
            for (let y = 0; y < 5; y++) {
                for (let x = 0; x < 5; x++) {
                    let classes = 'map-cell';
                    if (x === player.x && y === player.y) classes += ' player';
                    if (visited[`${x},${y}`]) classes += ' visited';
                    html += `<div class="${classes}" onclick="moveTo(${x},${y})">${map[y][x]}</div>`;
                }
            }
            document.getElementById('map').innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        function updateInventory() {
            let html = '';
            for (let [item, count] of Object.entries(player.inventory)) {
                if (count > 0) {
                    const icons = {
                        wood: 'ü™µ',
                        iron: '‚õìÔ∏è',
                        weapons: '‚öîÔ∏è',
                        treasure: 'üíé'
                    };
                    html += `<div class="inventory-item">${icons[item] || 'üì¶'} ${count}</div>`;
                }
            }
            document.getElementById('inventory').innerHTML = html;
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ª–æ–≥
        function addLog(text) {
            const logDiv = document.getElementById('log');
            logDiv.innerHTML += `<div class="log-entry">‚öîÔ∏è ${text}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
        function move(dir) {
            let newX = player.x;
            let newY = player.y;
            
            if (dir === 'north' && player.y > 0) newY--;
            if (dir === 'south' && player.y < 4) newY++;
            if (dir === 'west' && player.x > 0) newX--;
            if (dir === 'east' && player.x < 4) newX++;
            
            if (newX !== player.x || newY !== player.y) {
                player.x = newX;
                player.y = newY;
                player.food -= 5;
                player.day++;
                
                if (player.food <= 0) {
                    player.crew -= 5;
                    player.food = 0;
                    addLog('–ì–æ–ª–æ–¥! –ü–æ—Ç–µ—Ä–∏ –≤ –¥—Ä—É–∂–∏–Ω–µ');
                }
                
                visited[`${player.x},${player.y}`] = true;
                locationEvent();
                renderMap();
                updateStats();
                updateInventory();
            }
        }
        
        function moveTo(x, y) {
            if (x !== player.x || y !== player.y) {
                player.x = x;
                player.y = y;
                player.food -= 5;
                player.day++;
                locationEvent();
                renderMap();
                updateStats();
                updateInventory();
            }
        }
        
        // –°–æ–±—ã—Ç–∏–µ –≤ –ª–æ–∫–∞—Ü–∏–∏
        function locationEvent() {
            let cell = map[player.y][player.x];
            let event = '';
            
            if (cell === 'üè°' || cell === 'üè∞') {
                let r = Math.random();
                if (r < 0.3) {
                    player.gold += 50;
                    event = '–ù–∞—à–ª–∏ –∑–æ–ª–æ—Ç–æ! +50';
                } else if (r < 0.6) {
                    player.crew += 5;
                    event = '–ö –≤–∞–º –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –≤–æ–∏–Ω—ã! +5';
                } else {
                    player.power += 10;
                    event = '–ú–µ—Å—Ç–Ω—ã–µ –∫—É–∑–Ω–µ—Ü—ã –ø–æ—á–∏–Ω–∏–ª–∏ –æ—Ä—É–∂–∏–µ! +10 —Å–∏–ª—ã';
                }
            } else if (cell === 'üå≤') {
                let r = Math.random();
                if (r < 0.4) {
                    player.food += 20;
                    event = '–£–¥–∞—á–Ω–∞—è –æ—Ö–æ—Ç–∞! +20 –µ–¥—ã';
                } else if (r < 0.7) {
                    player.crew -= 3;
                    event = '–ù–∞–ø–∞–ª–∏ –≤–æ–ª–∫–∏! -3 –¥—Ä—É–∂–∏–Ω—ã';
                }
            } else if (cell === '‚õ∞Ô∏è') {
                let r = Math.random();
                if (r < 0.3) {
                    player.gold += 100;
                    player.inventory.treasure++;
                    event = '–ù–∞—à–ª–∏ –ø–µ—â–µ—Ä—É —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏! +100 –∑–æ–ª–æ—Ç–∞';
                } else if (r < 0.6) {
                    player.crew -= 5;
                    event = '–ö–∞–º–Ω–µ–ø–∞–¥! -5 –¥—Ä—É–∂–∏–Ω—ã';
                }
            } else if (cell === 'üåä') {
                let r = Math.random();
                if (r < 0.3) {
                    player.gold += 30;
                    event = '–ù–∞—à–ª–∏ –∑–∞—Ç–æ–Ω—É–≤—à–∏–π –∫–æ—Ä–∞–±–ª—å! +30 –∑–æ–ª–æ—Ç–∞';
                } else if (r < 0.6) {
                    player.crew -= 8;
                    event = '–®—Ç–æ—Ä–º! -8 –¥—Ä—É–∂–∏–Ω—ã';
                }
            }
            
            if (event) {
                addLog(event);
            }
        }
        
        // –î–µ–π—Å—Ç–≤–∏—è
        function rest() {
            player.power += 20;
            if (player.power > 100) player.power = 100;
            player.food -= 10;
            player.day++;
            addLog('–û—Ç–¥—ã—Ö +20 —Å–∏–ª—ã, -10 –µ–¥—ã');
            updateStats();
        }
        
        function hunt() {
            if (map[player.y][player.x] === 'üå≤') {
                let success = Math.random() < 0.7;
                if (success) {
                    player.food += 30;
                    addLog('–£–¥–∞—á–Ω–∞—è –æ—Ö–æ—Ç–∞! +30 –µ–¥—ã');
                } else {
                    player.crew -= 2;
                    addLog('–û—Ö–æ—Ç–∞ –ø—Ä–æ–≤–∞–ª–∏–ª–∞—Å—å, –ø–æ—Ç–µ—Ä–∏ -2');
                }
            } else {
                addLog('–ó–¥–µ—Å—å –Ω–µ –Ω–∞ –∫–æ–≥–æ –æ—Ö–æ—Ç–∏—Ç—å—Å—è');
            }
            player.day++;
            updateStats();
        }
        
        function trade() {
            let cell = map[player.y][player.x];
            if (cell === 'üè°' || cell === 'üè∞') {
                if (player.gold >= 50) {
                    player.gold -= 50;
                    player.food += 40;
                    player.power += 15;
                    player.inventory.weapons += 2;
                    player.day++;
                    addLog('–¢–æ—Ä–≥–æ–≤–ª—è: -50 –∑–æ–ª–æ—Ç–∞, +40 –µ–¥—ã, +15 —Å–∏–ª—ã, +2 –æ—Ä—É–∂–∏—è');
                } else {
                    addLog('–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∑–æ–ª–æ—Ç–∞');
                }
            } else {
                addLog('–ó–¥–µ—Å—å –Ω–µ —Å –∫–µ–º —Ç–æ—Ä–≥–æ–≤–∞—Ç—å');
            }
            updateStats();
            updateInventory();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadGame();
        renderMap();
        updateStats();
        updateInventory();
        addLog('–°–∞–≥–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è...');
    </script>
</body>
</html>